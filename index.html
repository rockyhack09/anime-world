<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANIMAX PREMIUM | RJ ROCKY</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        :root { --bg: #060606; --primary: #e50914; --gold: #ffd700; --card: #181818; }
        body { margin: 0; font-family: 'Poppins', sans-serif; background: var(--bg); color: #fff; overflow-x: hidden; }

        /* Login Screen with Anime Background */
        #login-screen { 
            height: 100vh; display: none; flex-direction: column; justify-content: center; align-items: center;
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.9)), url('https://images.alphacoders.com/132/1327173.png');
            background-size: cover; background-position: center; text-align: center;
        }
        .login-card { background: rgba(0,0,0,0.7); padding: 40px; border-radius: 20px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }

        /* Navigation */
        nav { padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.95); position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid #222; }
        .logo { color: var(--primary); font-size: 26px; font-weight: 800; letter-spacing: 1px; }
        .profile-trigger img { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--gold); padding: 2px; cursor: pointer; }

        /* Hero Banner */
        .hero-banner {
            width: 90%; margin: 20px auto; height: 200px; border-radius: 15px;
            background: linear-gradient(to right, rgba(0,0,0,0.9), transparent), url('https://images7.alphacoders.com/613/613926.jpg');
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; justify-content: center; padding: 25px; box-sizing: border-box;
            border: 1px solid #333;
        }

        /* Search Bar */
        .search-container { padding: 10px 5%; }
        #search-input {
            width: 100%; padding: 12px 25px; border-radius: 30px; border: 1px solid #333;
            background: #111; color: #fff; outline: none; font-size: 14px; transition: 0.3s;
        }
        #search-input:focus { border-color: var(--primary); }

        /* Grid System */
        .section-title { padding: 20px 5% 5px; font-size: 18px; color: var(--gold); font-weight: 700; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; padding: 15px 5%; }
        .card { background: var(--card); border-radius: 12px; overflow: hidden; border: 1px solid #222; cursor: pointer; position: relative; transition: 0.3s; }
        .card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .card img { width: 100%; height: 210px; object-fit: cover; }
        .card h3 { padding: 10px; font-size: 12px; margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .p-tag { position: absolute; top: 10px; left: 10px; background: var(--gold); color: #000; padding: 3px 8px; font-size: 10px; font-weight: 800; border-radius: 4px; }

        /* Sidebar - Queen Dashboard */
        .sidebar { position: fixed; top: 0; right: -320px; width: 300px; height: 100%; background: #111; z-index: 2000; transition: 0.4s; padding: 40px 20px; border-left: 2.5px solid var(--gold); box-sizing: border-box; text-align: center; }
        .sidebar.active { right: 0; }
        .sidebar img { width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--gold); margin-bottom: 15px; }

        /* Buttons */
        .btn { width: 100%; padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; }
        .btn-red { background: var(--primary); color: #fff; }
        .btn-gold { background: var(--gold); color: #000; }

        /* Video Modal */
        #player-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 4000; }
        .close-vid { position: absolute; top: 20px; right: 30px; font-size: 40px; color: #fff; cursor: pointer; }
        iframe { width: 100%; height: 100%; border: none; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-card">
            <h1 style="color:var(--primary); font-size: 40px; margin:0;">ANIMAX</h1>
            <p style="margin-bottom:30px; font-size:14px; color:#ccc;">Exclusive Anime by RJ ROCKY</p>
            <button class="btn btn-red" onclick="signIn()" style="width:auto; padding:12px 40px; border-radius:50px;">LOGIN WITH GOOGLE</button>
        </div>
    </div>

    <div id="main-app" style="display:none;">
        <nav>
            <div class="logo">ANIMAX</div>
            <div class="profile-trigger" onclick="toggleSidebar()"><img id="u-img" src=""></div>
        </nav>

        <div class="hero-banner">
            <h2 style="margin:0; color:var(--gold);">Solo Leveling</h2>
            <p style="font-size:12px; margin:5px 0 15px;">Weakest hunter to strongest King.</p>
            <button class="btn btn-red" style="width:auto; padding:8px 25px; font-size:12px;">WATCH NOW</button>
        </div>

        <div class="search-container">
            <input type="text" id="search-input" placeholder="Search anime..." onkeyup="searchAnime()">
        </div>

        <div id="history-sec" style="display:none;">
            <div class="section-title">CONTINUE WATCHING</div>
            <div class="grid" id="history-grid"></div>
        </div>

        <div class="section-title">ALL ANIME</div>
        <div class="grid" id="anime-list"></div>

        <div class="sidebar" id="side-menu">
            <img id="d-img" src="">
            <h3 id="u-name" style="margin:0;">User</h3>
            <div id="u-status" style="color:var(--gold); font-size:12px; margin-bottom:20px;">FREE MEMBER</div>
            
            <div style="background:#1a1a1a; padding:15px; border-radius:12px; border:1.5px dashed var(--gold);">
                <p style="font-size:11px; color:var(--gold); margin-bottom:10px;">REDEEM 30-DAY KEY</p>
                <input type="text" id="key-input" placeholder="Enter Key" style="width:100%; padding:10px; background:#000; border:1px solid #333; color:#fff; text-align:center; margin-bottom:10px; border-radius:5px;">
                <button class="btn btn-gold" onclick="redeemKey()">ACTIVATE NOW</button>
            </div>

            <button class="btn btn-red" style="margin-top:30px;" onclick="contactAdmin()">BUY PREMIUM (TELEGRAM)</button>
            <p onclick="auth.signOut()" style="margin-top:30px; cursor:pointer; color:#444; font-size:13px;">Logout Account</p>
        </div>
    </div>

    <div id="player-modal">
        <span class="close-vid" onclick="closeVideo()">&times;</span>
        <iframe id="vid-frame" src="" allowfullscreen></iframe>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBcWE5TCxamMSnJxqSm5X4mgSwSccIXcBI",
            authDomain: "myanimeapp-8d079.firebaseapp.com",
            databaseURL: "https://myanimeapp-8d079-default-rtdb.firebaseio.com",
            projectId: "myanimeapp-8d079",
            storageBucket: "myanimeapp-8d079.firebasestorage.app",
            messagingSenderId: "37482342893",
            appId: "1:37482342893:web:bebc7352e4bc102b725fe4"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        let currentUser = null;
        let isPremium = false;
        let allAnime = [];

        function signIn() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }

        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('main-app').style.display = 'block';
                document.getElementById('u-img').src = user.photoURL;
                document.getElementById('d-img').src = user.photoURL;
                document.getElementById('u-name').innerText = user.displayName;

                // Online tracking
                const onlineRef = db.ref('online_users/' + user.uid);
                onlineRef.set({ name: user.displayName });
                onlineRef.onDisconnect().remove();

                checkPremium();
                loadHistory();
                loadAnime();
            } else {
                document.getElementById('login-screen').style.display = 'flex';
                document.getElementById('main-app').style.display = 'none';
            }
        });

        function checkPremium() {
            db.ref('users/' + currentUser.uid).on('value', snap => {
                const data = snap.val();
                if (data && data.premiumUntil > Date.now()) {
                    isPremium = true;
                    document.getElementById('u-status').innerText = "QUEEN PREMIUM ACTIVE";
                }
            });
        }

        function loadAnime() {
            db.ref('anime').on('value', snap => {
                allAnime = [];
                snap.forEach(child => { allAnime.push(child.val()); });
                displayAnime(allAnime);
            });
        }

        function displayAnime(data) {
            const list = document.getElementById('anime-list');
            list.innerHTML = "";
            data.forEach(v => {
                const isP = v.title.toLowerCase().includes("premium");
                list.innerHTML += `
                    <div class="card" onclick="watch('${v.url}', '${v.title}', '${v.thumbnail}', ${isP})">
                        ${isP ? '<div class="p-tag">PREMIUM</div>' : ''}
                        <img src="${v.thumbnail}" onerror="this.src='https://via.placeholder.com/200x300'">
                        <h3>${v.title}</h3>
                    </div>`;
            });
        }

        function searchAnime() {
            const q = document.getElementById('search-input').value.toLowerCase();
            const filtered = allAnime.filter(v => v.title.toLowerCase().includes(q));
            displayAnime(filtered);
        }

        function watch(url, title, thumb, isP) {
            if (isP && !isPremium) return alert("Unlock Premium to watch this!");
            const safeId = btoa(url).substring(0,20).replace(/[^a-zA-Z0-9]/g, "");
            db.ref('playlists/' + currentUser.uid + '/' + safeId).set({url, title, thumbnail: thumb});
            play(url);
        }

        function loadHistory() {
            db.ref('playlists/' + currentUser.uid).limitToLast(6).on('value', snap => {
                const grid = document.getElementById('history-grid');
                grid.innerHTML = "";
                if (snap.exists()) {
                    document.getElementById('history-sec').style.display = 'block';
                    snap.forEach(child => {
                        const v = child.val();
                        grid.innerHTML += `<div class="card" onclick="play('${v.url}')"><img src="${v.thumbnail}"><h3>${v.title}</h3></div>`;
                    });
                }
            });
        }

        function play(url) {
            let fUrl = url;
            if (url.includes("youtube.com/watch?v=")) fUrl = url.replace("watch?v=", "embed/");
            if (url.includes("drive.google.com")) fUrl = url.replace("/view", "/preview");
            document.getElementById('player-modal').style.display = 'block';
            document.getElementById('vid-frame').src = fUrl;
        }

        function redeemKey() {
            const key = document.getElementById('key-input').value.trim();
            db.ref('premium_codes/' + key).once('value', snap => {
                if (snap.exists() && snap.val().status === 'active') {
                    db.ref('users/' + currentUser.uid).update({ premiumUntil: Date.now() + 2592000000 });
                    db.ref('premium_codes/' + key).update({ status: 'used', usedBy: currentUser.email });
                    alert("30 Days Premium Unlocked!");
                    toggleSidebar();
                } else { alert("Invalid Key!"); }
            });
        }

        function contactAdmin() {
            const msg = encodeURIComponent(`I want to buy Premium.\nName: ${currentUser.displayName}\nEmail: ${currentUser.email}`);
            window.open(`https://t.me/aminezone09?text=${msg}`, '_blank');
        }

        function toggleSidebar() { document.getElementById('side-menu').classList.toggle('active'); }
        function closeVideo() { document.getElementById('player-modal').style.display = 'none'; document.getElementById('vid-frame').src = ""; }
    </script>
</body>
                </html>
                
